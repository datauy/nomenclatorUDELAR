<div id="map"></div>
<script>
const shadowUrl = "<%= image_path 'marker-shadow.png' %>";
const iconSVG = `
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   sodipodi:docname="dr-pin.svg"
   inkscape:version="1.0 (6e3e5246a0, 2020-05-07)"
   version="1.1"
   viewBox="0 0 10.583333 10.583333"
   height="40"
   width="40">
  <defs
     id="defs865" />
  <sodipodi:namedview
     inkscape:window-maximized="1"
     inkscape:window-y="27"
     inkscape:window-x="67"
     inkscape:window-height="845"
     inkscape:window-width="1533"
     units="px"
     fit-margin-bottom="0"
     fit-margin-right="0"
     fit-margin-left="0"
     fit-margin-top="0"
     showgrid="false"
     inkscape:document-rotation="0"
     inkscape:current-layer="layer1"
     inkscape:document-units="mm"
     inkscape:cy="24.871424"
     inkscape:cx="12.760924"
     inkscape:zoom="8.4074846"
     inkscape:pageshadow="2"
     inkscape:pageopacity="0.0"
     borderopacity="1.0"
     bordercolor="#666666"
     pagecolor="#ffffff"
     id="base" />
  <metadata
     id="metadata868">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     transform="translate(-178.35759,-236.37414)"
     id="layer1"
     inkscape:groupmode="layer"
     inkscape:label="Capa 1">
    <path
       style="stroke-width:0.264583"
       id="path126"
       d="m 183.64925,236.89114 c 2.1135,0 3.82694,1.64438 3.82694,3.67294 0,0.0474 -0.002,0.0952 -0.005,0.14341 0.003,0.0661 0.005,0.13282 0.005,0.19976 0,2.218 -3.43006,5.53323 -3.82694,5.53323 -0.39687,0 -3.82693,-3.31523 -3.82693,-5.53323 0,-0.0669 0.002,-0.13362 0.005,-0.19976 -0.003,-0.0482 -0.005,-0.0961 -0.005,-0.14341 0,-2.02856 1.71344,-3.67294 3.82693,-3.67294 z m 0,2.54661 c -0.78501,0 -1.42134,0.61754 -1.42134,1.37928 0,0.762 0.63633,1.37927 1.42134,1.37927 0.78502,0 1.42135,-0.61754 1.42135,-1.37927 0,-0.762 -0.63633,-1.37928 -1.42135,-1.37928 z" />
  </g>
</svg>
`;
//const iconDiv = iconSVG + '<img src="'+shadowUrl+'"></img>' ;

const iconDefault = L.divIcon({
  className: "salas-marker",
  // iconUrl: iconSVGUrl,
  html: iconSVG,
  shadowUrl,
  iconSize: [28, 38],
  iconAnchor: [14, 37],
  popupAnchor: [1, -34],
  tooltipAnchor: [16, -28],
  shadowSize: [41, 10],
  shadowAnchor: [14, -38]
});
L.Marker.prototype.options.icon = iconDefault;
$.getJSON("salas_de_lactancia_merged.geojson", function (salas) {
  this.animating = true;
  this.map = new L.Map("map", {minZoom:4}).setView([-11.336196, -63.605775], 4);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
  }).addTo(this.map);
  L.geoJSON(salas).addTo(this.map);
  var mapBounds = [];
  salas.features.forEach((feature) => {
    mapBounds.push(feature.geometry.coordinates.slice(0,2).reverse())
  })
  this.map.flyToBounds(mapBounds);
} );
</script>
